<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Detect - Vue.js Implementation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' };</script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
    <link href="style.css" rel="stylesheet"/>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <div id="app">
        <!-- Toast Container -->
        <div class="fixed bottom-4 right-4 space-y-2 z-50">
            <div v-for="toast in toasts" :key="toast.id" 
                 :class="['toast', toast.type, 'px-6 py-4 rounded-lg shadow-lg text-white flex items-center space-x-3']">
                <i :class="getToastIcon(toast.type)"></i>
                <span>{{ toast.message }}</span>
            </div>
        </div>

        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-blue-100 dark:bg-blue-900/20 rounded-lg">
                            <i class="fas fa-shield-alt text-blue-600 dark:text-blue-400 text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-900 dark:text-white">Cyber Detect</h1>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Advanced Security Log Analysis</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Export Buttons -->
                        <div v-if="analysisResults.length > 0" class="flex items-center space-x-2">
                            <button @click="generateReport" 
                                    class="flex items-center space-x-1 px-3 py-1 text-sm bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors">
                                <i class="fas fa-chart-bar"></i>
                                <span>Report</span>
                            </button>
                            <button @click="exportCSV" 
                                    class="flex items-center space-x-1 px-3 py-1 text-sm bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                <i class="fas fa-download"></i>
                                <span>CSV</span>
                            </button>
                            <button @click="exportJSON" 
                                    class="flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                <i class="fas fa-download"></i>
                                <span>JSON</span>
                            </button>
                        </div>
                        <!-- Theme Toggle -->
                        <button @click="toggleTheme" 
                                class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:inline"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button @click="activeView = 'overview'" 
                            :class="['nav-tab flex items-center space-x-2 px-3 py-4 text-sm font-medium border-b-2 transition-colors', 
                                   activeView === 'overview' ? 'active' : '']">
                        <i class="fas fa-shield-alt"></i>
                        <span>Overview</span>
                    </button>
                    <button @click="activeView = 'dashboard'" 
                            :class="['nav-tab flex items-center space-x-2 px-3 py-4 text-sm font-medium border-b-2 transition-colors', 
                                   activeView === 'dashboard' ? 'active' : '']">
                        <i class="fas fa-chart-bar"></i>
                        <span>Dashboard</span>
                    </button>
                    <button @click="activeView = 'data'" 
                            :class="['nav-tab flex items-center space-x-2 px-3 py-4 text-sm font-medium border-b-2 transition-colors', 
                                   activeView === 'data' ? 'active' : '']">
                        <i class="fas fa-database"></i>
                        <span>Data Table</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Overview View -->
            <div v-if="activeView === 'overview'" class="space-y-8">
                <!-- File Upload Section -->
                <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
                        Upload Log File or Try Demo
                    </h2>
                    
                    <!-- Demo Dataset Card -->
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 border-2 border-dashed border-blue-300 dark:border-blue-600 hover:border-blue-400 dark:hover:border-blue-500 transition-all duration-200 mb-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="p-2 bg-blue-500 rounded-lg">
                                    <i class="fas fa-database text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Demo Dataset</h3>
                                    <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Synthetic Apache Server Logs</p>
                                </div>
                            </div>
                            <a href="https://raw.githubusercontent.com/Yadav-Aayansh/gramener-datasets/add-server-logs/server_logs.zip" 
                               target="_blank" rel="noopener noreferrer"
                               class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-white/50 dark:hover:bg-gray-700/50 transition-colors">
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">
                            Test the application with pre-generated Apache server logs containing various security threats and attack patterns. 
                            Perfect for exploring all detection capabilities without needing your own log files.
                        </p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400">
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-download"></i>
                                    <span>ZIP Format</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Ready to Use</span>
                                </div>
                            </div>
                            <button @click="loadDemoDataset" 
                                    :disabled="isLoading"
                                    class="flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors">
                                <i class="fas fa-play"></i>
                                <span>Load Demo</span>
                            </button>
                        </div>
                    </div>

                    <!-- Divider -->
                    <div class="relative my-6">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-300 dark:border-gray-600"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400">
                                Or upload your own file
                            </span>
                        </div>
                    </div>

                    <!-- File Upload -->
                    <div @drop="handleFileDrop" @dragover.prevent @dragenter.prevent
                         :class="['relative border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 cursor-pointer',
                                isDragging ? 'file-upload-drag' : 'border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500']">
                        <input @change="handleFileSelect" ref="fileInput" 
                               type="file" accept=".log,.txt,.zip,.gz" 
                               class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"/>
                        <div class="flex flex-col items-center space-y-4">
                            <i class="fas fa-upload text-4xl text-gray-400"></i>
                            <div>
                                <p class="text-lg font-medium text-gray-900 dark:text-white mb-2">Upload Log File</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    Drag and drop your log file here, or click to select
                                </p>
                                <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">
                                    Supported formats: .log, .txt, .zip, .gz â€¢ Max size: 100MB
                                </p>
                            </div>
                        </div>
                    </div>

                    <div v-if="selectedFile" class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <p class="text-sm text-blue-800 dark:text-blue-200">
                            <i class="fas fa-file-alt mr-2"></i>
                            {{ selectedFile.name }} ({{ formatFileSize(selectedFile.size) }})
                        </p>
                    </div>
                </div>

                <!-- Attack Type Cards -->
                <div v-if="logData.length > 0" class="space-y-8">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Security Threat Analysis</h2>
                        <div class="flex items-center space-x-3">
                            <button @click="runAllScans" 
                                    :disabled="isScanning"
                                    class="flex items-center space-x-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                <i class="fas fa-shield-alt"></i>
                                <span>Run All Scans</span>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <div v-for="attackType in attackTypes" :key="attackType.endpoint" 
                             class="attack-card bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="p-2 rounded-lg" :style="{ backgroundColor: attackType.color + '20' }">
                                        <i class="fas fa-shield-alt text-xl" :style="{ color: attackType.color }"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">{{ attackType.name }}</h3>
                                        <span :class="['text-xs px-2 py-1 rounded-full font-medium', getSeverityClass(attackType.severity)]">
                                            {{ attackType.severity.toUpperCase() }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">{{ attackType.description }}</p>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <button @click="runScan(attackType)" 
                                            :disabled="isScanning"
                                            class="flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white rounded-lg transition-colors">
                                        <i v-if="scanningTypes.includes(attackType.endpoint)" class="fas fa-spinner fa-spin"></i>
                                        <i v-else class="fas fa-play"></i>
                                        <span>Scan</span>
                                    </button>
                                    
                                    <button @click="viewFunction(attackType)" 
                                            class="flex items-center space-x-1 px-3 py-1 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                                        <i class="fas fa-code"></i>
                                        <span>View Function</span>
                                    </button>
                                </div>
                                
                                <button v-if="getAnalysisResult(attackType.endpoint)" 
                                        @click="viewResult(attackType)" 
                                        class="flex items-center space-x-1 px-3 py-1 text-sm bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                    <i class="fas fa-eye"></i>
                                    <span>View Result</span>
                                </button>
                            </div>
                            
                            <div v-if="getAnalysisResult(attackType.endpoint)" class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-300">Threats Found:</span>
                                    <span :class="['font-semibold', getAnalysisResult(attackType.endpoint).threats.length > 0 ? 'text-red-600' : 'text-green-600']">
                                        {{ getAnalysisResult(attackType.endpoint).threats.length }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Analysis Section -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Custom Analysis</h3>
                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center space-x-3">
                                    <div class="p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg">
                                        <i class="fas fa-magic text-purple-600 dark:text-purple-400 text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">AI-Powered Custom Analysis</h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-300">Describe what you want to analyze and AI will create the detection logic</p>
                                    </div>
                                </div>
                                <button @click="showAiConfig = !showAiConfig" 
                                        class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>

                            <!-- AI Configuration Panel -->
                            <div v-if="showAiConfig" class="mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <h4 class="text-sm font-medium text-gray-900 dark:text-white mb-3">AI Provider Configuration</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">AI Provider</label>
                                        <select v-model="aiProvider" @change="saveAiConfig" 
                                                class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900 dark:text-white">
                                            <option v-for="provider in llmProviders" :key="provider.id" :value="provider.id">
                                                {{ provider.name }}
                                            </option>
                                        </select>
                                    </div>
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">API Key</label>
                                            <a v-if="currentProvider?.apiKeyLink" :href="currentProvider.apiKeyLink" target="_blank" rel="noopener noreferrer"
                                               class="text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 flex items-center space-x-1">
                                                <span>Get API Key</span>
                                                <i class="fas fa-external-link-alt text-xs"></i>
                                            </a>
                                        </div>
                                        <input v-model="aiApiKey" @input="saveAiConfig" type="password" 
                                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                               placeholder="Enter your API key..."/>
                                    </div>
                                    <div v-if="currentProvider?.customEndpoint">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">API Endpoint</label>
                                        <input v-model="customEndpoint" @input="saveAiConfig" type="url" 
                                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                               :placeholder="currentProvider.defaultEndpoint || 'https://api.example.com/v1/chat/completions'"/>
                                    </div>
                                </div>
                            </div>

                            <!-- Analysis Input Form -->
                            <form @submit.prevent="createCustomAnalysis($refs.analysisInput.value)" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Describe the analysis you want to perform
                                    </label>
                                    <textarea ref="analysisInput" 
                                              class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none" 
                                              placeholder="e.g., Look for password or secret extraction attacks, Find attempts to access sensitive configuration files..." 
                                              rows="3"></textarea>
                                </div>
                                <button type="submit" :disabled="!aiApiKey || isLoading"
                                        class="w-full flex items-center justify-center space-x-2 px-4 py-3 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors">
                                    <i class="fas fa-plus"></i>
                                    <span>Create Custom Analysis</span>
                                </button>
                            </form>

                            <!-- Example Prompts -->
                            <div class="mt-6">
                                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Example Analysis Ideas:</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    <button v-for="prompt in ['Look for password or secret extraction attacks', 'Detect attempts to access configuration files', 'Find suspicious file upload attempts', 'Identify potential data exfiltration patterns', 'Detect API abuse or rate limiting violations', 'Find attempts to access backup files']" 
                                            :key="prompt" @click="$refs.analysisInput.value = prompt"
                                            class="text-left p-3 text-sm bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 rounded-lg transition-colors">
                                        <div class="flex items-start space-x-2">
                                            <i class="fas fa-sparkles text-purple-500 mt-0.5 flex-shrink-0"></i>
                                            <span class="text-gray-700 dark:text-gray-300">{{ prompt }}</span>
                                        </div>
                                    </button>
                                </div>
                            </div>

                            <div v-if="!aiApiKey" class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-brain text-yellow-600 dark:text-yellow-400"></i>
                                    <p class="text-sm text-yellow-800 dark:text-yellow-200">
                                        Please configure your AI provider settings to create custom analyses
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Analysis Results -->
                    <div v-if="customAnalysisResults.length > 0" class="mt-8">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Custom Analysis Results</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            <div v-for="result in customAnalysisResults" :key="result.type" 
                                 class="attack-card bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center space-x-3">
                                        <div class="p-2 rounded-lg" :style="{ backgroundColor: result.color + '20' }">
                                            <i class="fas fa-magic text-xl" :style="{ color: result.color }"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">{{ result.name }}</h3>
                                            <span class="text-xs px-2 py-1 rounded-full font-medium bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300">
                                                CUSTOM
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">{{ result.description }}</p>
                                
                                <div class="flex items-center justify-between">
                                    <button @click="currentFunction = result; showFunctionModal = true" 
                                            class="flex items-center space-x-1 px-3 py-1 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                                        <i class="fas fa-code"></i>
                                        <span>View Code</span>
                                    </button>
                                    
                                    <button @click="currentResult = result; showResultModal = true" 
                                            class="flex items-center space-x-1 px-3 py-1 text-sm bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                        <i class="fas fa-eye"></i>
                                        <span>View Result</span>
                                    </button>
                                </div>
                                
                                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-gray-600 dark:text-gray-300">Threats Found:</span>
                                        <span :class="['font-semibold', result.threats.length > 0 ? 'text-red-600' : 'text-green-600']">
                                            {{ result.threats.length }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div v-if="activeView === 'dashboard'" class="space-y-6">
                <div v-if="analysisResults.length === 0 && customAnalysisResults.length === 0" class="text-center py-12">
                    <i class="fas fa-chart-bar text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No Analysis Data</h3>
                    <p class="text-gray-600 dark:text-gray-300">Run some scans first to see dashboard visualizations.</p>
                </div>
                
                <div v-else>
                    <!-- Dashboard content will be implemented here -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div v-for="result in [...analysisResults, ...customAnalysisResults]" :key="result.type" 
                             class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">{{ result.name }}</h3>
                            <p class="text-3xl font-bold" :style="{ color: result.color }">{{ result.threats.length }}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Threats detected</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Table View -->
            <div v-if="activeView === 'data'" class="space-y-6">
                <div v-if="analysisResults.length === 0 && customAnalysisResults.length === 0" class="text-center py-12">
                    <i class="fas fa-database text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">No Data Available</h3>
                    <p class="text-gray-600 dark:text-gray-300">Run some scans first to see detailed data tables.</p>
                </div>
                
                <div v-else>
                    <!-- Filters Section -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Filters</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <!-- Search -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Search</label>
                                <input v-model="dataFilters.searchTerm" type="text" 
                                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                       placeholder="Search URL, IP, User Agent..."/>
                            </div>
                            
                            <!-- Methods -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Methods</label>
                                <div class="space-y-1 max-h-32 overflow-y-auto">
                                    <label v-for="method in availableFilters.methods" :key="method" class="flex items-center">
                                        <input type="checkbox" :checked="dataFilters.selectedMethods.includes(method)" 
                                               @change="toggleMethodFilter(method)"
                                               class="custom-checkbox mr-2"/>
                                        <span :class="['text-xs px-2 py-1 rounded font-medium', getMethodClass(method)]">{{ method }}</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Status Codes -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status Codes</label>
                                <div class="space-y-1 max-h-32 overflow-y-auto">
                                    <label v-for="status in availableFilters.statuses" :key="status" class="flex items-center">
                                        <input type="checkbox" :checked="dataFilters.selectedStatuses.includes(status)" 
                                               @change="toggleStatusFilter(status)"
                                               class="custom-checkbox mr-2"/>
                                        <span :class="['text-xs px-2 py-1 rounded font-medium', getStatusClass(status)]">{{ status }}</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Top IPs -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Top IPs</label>
                                <div class="space-y-1 max-h-32 overflow-y-auto">
                                    <label v-for="ip in availableFilters.ips.slice(0, 10)" :key="ip" class="flex items-center">
                                        <input type="checkbox" :checked="dataFilters.selectedIPs.includes(ip)" 
                                               @change="toggleIPFilter(ip)"
                                               class="custom-checkbox mr-2"/>
                                        <span class="text-sm text-gray-700 dark:text-gray-300 truncate">{{ ip }}</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 flex items-center justify-between">
                            <span class="text-sm text-gray-600 dark:text-gray-300">
                                Showing {{ filteredLogData.length }} of {{ logData.length }} entries
                            </span>
                            <button @click="clearFilters" 
                                    class="px-4 py-2 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                                Clear Filters
                            </button>
                        </div>
                    </div>

                    <!-- Analysis Results Tables -->
                    <div v-for="result in [...analysisResults, ...customAnalysisResults]" :key="result.type" class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">{{ result.name }} - {{ result.threats.length }} threats</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Timestamp</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">IP Address</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Method</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">URL</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr v-for="threat in result.threats.slice(0, 100)" :key="threat.id">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">{{ threat.timestamp }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">{{ threat.ip }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="['text-xs px-2 py-1 rounded font-medium', getMethodClass(threat.method)]">
                                                {{ threat.method }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white truncate max-w-xs">{{ threat.url }}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="['text-xs px-2 py-1 rounded font-medium', getStatusClass(threat.status)]">
                                                {{ threat.status }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Function Modal -->
        <div v-if="showFunctionModal" @click="closeFunctionModal" 
             class="fixed inset-0 bg-black/50 flex justify-center z-50 p-4 overflow-y-auto sm:items-center items-start">
            <div @click.stop class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg">
                            <i class="fas fa-code text-purple-600 dark:text-purple-400"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">{{ currentFunction?.name }} Detection Function</h2>
                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ currentFunction?.description }}</p>
                        </div>
                    </div>
                    <button @click="closeFunctionModal" 
                            class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="bg-gray-900 dark:bg-gray-950 rounded-lg overflow-hidden">
                        <div class="flex items-center justify-between px-4 py-2 bg-gray-800 dark:bg-gray-900 border-b border-gray-700">
                            <span class="text-sm font-medium text-gray-300">Detection Function</span>
                        </div>
                        <pre class="p-4 text-sm font-mono text-gray-100 overflow-x-auto whitespace-pre-wrap max-h-96 overflow-y-auto"><code>{{ currentFunction?.code }}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
        <!-- Result Modal -->
        <div v-if="showResultModal" @click="closeResultModal" 
             class="fixed inset-0 bg-black/50 flex justify-center z-50 p-4 overflow-y-auto sm:items-center items-start">
            <div @click.stop class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 rounded-lg" :style="{ backgroundColor: currentResult?.color + '20' }">
                            <i :class="currentResult?.isCustom ? 'fas fa-magic' : 'fas fa-shield-alt'" 
                               class="text-xl" :style="{ color: currentResult?.color }"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">{{ currentResult?.name }} Results</h2>
                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ currentResult?.threats.length }} threats detected</p>
                        </div>
                    </div>
                    <button @click="closeResultModal" 
                            class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Timestamp</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">IP Address</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Method</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">URL</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">User Agent</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                <tr v-for="threat in currentResult?.threats" :key="threat.id">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">{{ threat.timestamp }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white">{{ threat.ip }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span :class="['text-xs px-2 py-1 rounded font-medium', getMethodClass(threat.method)]">
                                            {{ threat.method }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-900 dark:text-white break-all max-w-xs">{{ threat.url }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span :class="['text-xs px-2 py-1 rounded font-medium', getStatusClass(threat.status)]">
                                            {{ threat.status }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-900 dark:text-white break-all max-w-xs">{{ threat.userAgent || '-' }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Modal -->
        <div v-if="showReportModal" @click="closeReportModal" 
             class="fixed inset-0 bg-black/50 flex justify-center z-50 p-4 overflow-y-auto sm:items-center items-start">
            <div @click.stop class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-y-auto animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg">
                            <i class="fas fa-chart-bar text-purple-600 dark:text-purple-400"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">Security Analysis Report</h2>
                            <p class="text-sm text-gray-500 dark:text-gray-400">AI-powered comprehensive security assessment</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button @click="showReportConfig = !showReportConfig" 
                                class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button @click="closeReportModal" 
                                class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Report Config Panel -->
                <div v-if="showReportConfig" class="p-6 bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600">
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">AI Provider Configuration</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">AI Provider</label>
                            <select v-model="aiProvider" @change="saveAiConfig" 
                                    class="w-full px-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-gray-900 dark:text-white">
                                <option v-for="provider in llmProviders" :key="provider.id" :value="provider.id">
                                    {{ provider.name }}
                                </option>
                            </select>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">API Key</label>
                                <a v-if="currentProvider?.apiKeyLink" :href="currentProvider.apiKeyLink" target="_blank" rel="noopener noreferrer"
                                   class="text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 flex items-center space-x-1">
                                    <span>Get API Key</span>
                                    <i class="fas fa-external-link-alt text-xs"></i>
                                </a>
                            </div>
                            <input v-model="aiApiKey" @input="saveAiConfig" type="password" 
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                   placeholder="Enter your API key..."/>
                        </div>
                        <div v-if="currentProvider?.customEndpoint">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">API Endpoint</label>
                            <input v-model="customEndpoint" @input="saveAiConfig" type="url" 
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                   :placeholder="currentProvider.defaultEndpoint || 'https://api.example.com/v1/chat/completions'"/>
                        </div>
                    </div>
                </div>

                <div class="flex-1 flex flex-col min-h-0">
                    <!-- Report Generation Interface -->
                    <div v-if="!reportContent" class="p-8 text-center">
                        <div class="max-w-md mx-auto">
                            <div class="p-4 bg-purple-100 dark:bg-purple-900/20 rounded-full w-20 h-20 mx-auto mb-6 flex items-center justify-center">
                                <i class="fas fa-sparkles text-purple-600 dark:text-purple-400 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Generate AI Security Report</h3>
                            <p class="text-gray-600 dark:text-gray-300 mb-8">
                                Create a comprehensive security analysis report with AI-powered insights, 
                                recommendations, and actionable security measures based on your log analysis results.
                            </p>
                            <div v-if="!aiApiKey" class="mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                                <p class="text-sm text-yellow-800 dark:text-yellow-200">
                                    Please configure your AI provider settings above to generate reports.
                                </p>
                            </div>
                            <button @click="generateReport" :disabled="!aiApiKey || isGeneratingReport"
                                    class="flex items-center justify-center space-x-2 px-8 py-3 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg font-medium transition-colors mx-auto">
                                <i v-if="isGeneratingReport" class="fas fa-spinner fa-spin"></i>
                                <i v-else class="fas fa-chart-bar"></i>
                                <span>{{ isGeneratingReport ? 'Generating...' : 'Generate Security Report' }}</span>
                            </button>
                        </div>
                    </div>

                    <!-- Report Display -->
                    <div v-else class="flex flex-col h-full">
                        <div class="flex items-center justify-between px-6 py-3 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex space-x-1">
                                <button @click="reportTab = 'preview'" 
                                        :class="['report-tab px-4 py-2 text-sm font-medium rounded-lg transition-colors', reportTab === 'preview' ? 'active' : '']">
                                    Preview
                                </button>
                                <button @click="reportTab = 'markdown'" 
                                        :class="['report-tab px-4 py-2 text-sm font-medium rounded-lg transition-colors', reportTab === 'markdown' ? 'active' : '']">
                                    Markdown
                                </button>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button @click="copyReport" 
                                        class="flex items-center space-x-1 px-3 py-1 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors">
                                    <i class="fas fa-copy"></i>
                                    <span>Copy</span>
                                </button>
                                <button @click="downloadMarkdown" 
                                        class="flex items-center space-x-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                    <i class="fas fa-download"></i>
                                    <span>MD</span>
                                </button>
                                <button @click="downloadHTML" 
                                        class="flex items-center space-x-1 px-3 py-1 text-sm bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                    <i class="fas fa-download"></i>
                                    <span>HTML</span>
                                </button>
                            </div>
                        </div>
                        <div class="flex-1 min-h-0">
                            <div v-if="reportTab === 'preview'" class="p-6 prose prose-lg max-w-none dark:prose-invert overflow-y-auto h-full report-content" v-html="reportContent"></div>
                            <div v-else class="p-6 h-full">
                                <pre class="bg-gray-900 dark:bg-gray-950 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm font-mono whitespace-pre-wrap border border-gray-700 h-full overflow-y-auto">{{ reportMarkdown }}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="vue.js"></script>
</body>
</html>